import { Box, Text } from '@chakra-ui/react';
import { useEffect } from 'react';
import { GoogleMap, LoadScript, Marker } from '@react-google-maps/api';
import { useAuthState } from 'react-firebase-hooks/auth';
import { auth, firestore } from '../firebase/firebase';
import { doc, setDoc } from 'firebase/firestore';

const containerStyle = {
  width: '100%',
  height: '400px',
};

const center = {
  lat: 41.104, // İstanbul merkez
  lng: 29.033,
};

const HomePage = () => {
  const [authUser] = useAuthState(auth);

  useEffect(() => {
    if (authUser) {
      navigator.geolocation.getCurrentPosition(
        (position) => {
          const { latitude, longitude } = position.coords;
          setDoc(doc(firestore, 'users', authUser.uid), { location: { latitude, longitude } }, { merge: true });
        },
        (error) => console.error('Konum alınamadı:', error)
      );
    }
  }, [authUser]);

  return (
    <Box maxW="sm" mx="auto" p={4}>
      <Text fontSize="xl" fontWeight="bold" textAlign="center" mb={4}>
        Lovixa Harita
      </Text>
      <LoadScript googleMapsApiKey={process.env.REACT_APP_GOOGLE_MAPS_API_KEY}>
        <GoogleMap
          mapContainerStyle={containerStyle}
          center={center}
          zoom={12}
        >
          {authUser && (
            <Marker position={center} />
          )}
        </GoogleMap>
      </LoadScript>
    </Box>
  );
};

export default HomePage;